!function(e){var t={cloud:{}};!function(t){var n={exports:{}},r={};!function(e){var t,i={NOT_RESOLVED:"NOT_RESOLVED",IN_RESOLVING:"IN_RESOLVING",RESOLVED:"RESOLVED"},o=function(){var n={trackCircularDependencies:!0,allowMultipleDeclarations:!0},r={},h=!1,p=[],_=function(e,n,o){o||(o=n,n=[]);var a=r[e];a||(a=r[e]={name:e,decl:t}),a.decl={name:e,prev:a.decl,fn:o,state:i.NOT_RESOLVED,deps:n,dependents:[],exports:t}},v=function(t,n,r){"string"==typeof t&&(t=[t]),h||(h=!0,f(w)),p.push({deps:t,cb:function(t,i){i?(r||a)(i):n.apply(e,t)}})},y=function(e){var t=r[e];return t?i[t.decl.state]:"NOT_DEFINED"},g=function(e){return!!r[e]},m=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},b=function(){var e,t={};for(var n in r)r.hasOwnProperty(n)&&(e=r[n],(t[e.decl.state]||(t[e.decl.state]=[])).push(n));return t},w=function(){h=!1,E()},E=function(){var e,t=p,n=0;for(p=[];e=t[n++];)S(null,e.deps,[],e.cb)},S=function(e,t,n,i){var o=t.length;o||i([]);for(var a,u,c=[],d=function(e,t){if(t)return void i(null,t);if(!--o){for(var n,r=[],a=0;n=c[a++];)r.push(n.exports);i(r)}},l=0,f=o;f>l;){if(a=t[l++],"string"==typeof a){if(!r[a])return void i(null,s(a,e));u=r[a].decl}else u=a;c.push(u),x(u,n,d)}},x=function(t,r,o){if(t.state===i.RESOLVED)return void o(t.exports);if(t.state===i.IN_RESOLVING)return void(n.trackCircularDependencies&&l(t,r)?o(null,u(t,r)):t.dependents.push(o));if(t.dependents.push(o),t.prev&&!n.allowMultipleDeclarations)return void R(t,d(t));n.trackCircularDependencies&&(r=r.slice()).push(t);var a=!1,s=t.prev?t.deps.concat([t.prev]):t.deps;t.state=i.IN_RESOLVING,S(t,s,r,function(n,r){return r?void R(t,r):(n.unshift(function(e,n){return a?void o(null,c(t)):(a=!0,void(n?R(t,n):I(t,e)))}),void t.fn.apply({name:t.name,deps:t.deps,global:e},n))})},I=function(e,n){e.exports=n,e.state=i.RESOLVED;for(var r,o=0;r=e.dependents[o++];)r(n);e.dependents=t},R=function(e,t){e.state=i.NOT_RESOLVED;for(var n,r=0;n=e.dependents[r++];)n(null,t);e.dependents=[]};return{create:o,define:_,require:v,getState:y,isDefined:g,setOptions:m,getStat:b}},a=function(e){f(function(){throw e})},s=function(e,t){return Error(t?'Module "'+t.name+'": can\'t resolve dependence "'+e+'"':'Required module "'+e+"\" can't be resolved")},u=function(e,t){for(var n,r=[],i=0;n=t[i++];)r.push(n.name);return r.push(e.name),Error('Circular dependence has been detected: "'+r.join(" -> ")+'"')},c=function(e){return Error('Declaration of module "'+e.name+'" has already been provided')},d=function(e){return Error('Multiple declarations of module "'+e.name+'" have been detected')},l=function(e,t){for(var n,r=0;n=t[r++];)if(e===n)return!0;return!1},f=function(){var t=[],n=function(e){return 1===t.push(e)},r=function(){var e=t,n=0,r=t.length;for(t=[];r>n;)e[n++]()};if("object"==typeof process&&process.nextTick)return function(e){n(e)&&process.nextTick(r)};if(e.setImmediate)return function(t){n(t)&&e.setImmediate(r)};if(e.postMessage&&!e.opera){var i=!0;if(e.attachEvent){var o=function(){i=!1};e.attachEvent("onmessage",o),e.postMessage("__checkAsync","*"),e.detachEvent("onmessage",o)}if(i){var a="__modules"+ +new Date,s=function(e){e.data===a&&(e.stopPropagation&&e.stopPropagation(),r())};return e.addEventListener?e.addEventListener("message",s,!0):e.attachEvent("onmessage",s),function(t){n(t)&&e.postMessage(a,"*")}}}var u=e.document;if("onreadystatechange"in u.createElement("script")){var c=u.getElementsByTagName("head")[0],d=function(){var e=u.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,r()},c.appendChild(e)};return function(e){n(e)&&d()}}return function(e){n(e)&&setTimeout(r,0)}}();"object"==typeof r?n.exports=o():e.modules=o()}("undefined"!=typeof window?window:e),t.modules=n.exports}(t),function(t){var n={exports:{}};!function(e){var t,r=function(){var t=[],n=function(e){return 1===t.push(e)},r=function(){var e=t,n=0,r=t.length;for(t=[];r>n;)e[n++]()};if("function"==typeof setImmediate)return function(e){n(e)&&setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(e){n(e)&&process.nextTick(r)};var i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=1,a=document.createTextNode("");return new i(r).observe(a,{characterData:!0}),function(e){n(e)&&(a.data=o*=-1)}}if(e.postMessage){var s=!0;if(e.attachEvent){var u=function(){s=!1};e.attachEvent("onmessage",u),e.postMessage("__checkAsync","*"),e.detachEvent("onmessage",u)}if(s){var c="__promise"+Math.random()+"_"+new Date,d=function(e){e.data===c&&(e.stopPropagation&&e.stopPropagation(),r())};return e.addEventListener?e.addEventListener("message",d,!0):e.attachEvent("onmessage",d),function(t){n(t)&&e.postMessage(c,"*")}}}var l=e.document;if("onreadystatechange"in l.createElement("script")){var f=function(){var e=l.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,r()},(l.documentElement||l.body).appendChild(e)};return function(e){n(e)&&f()}}return function(e){n(e)&&setTimeout(r,0)}}(),i=function(e){r(function(){throw e})},o=function(e){return"function"==typeof e},a=function(e){return null!==e&&"object"==typeof e},s=Object.prototype.toString,u=Array.isArray||function(e){return"[object Array]"===s.call(e)},c=function(e){for(var t=[],n=0,r=e.length;r>n;)t.push(n++);return t},d=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},l=function(e){var t=function(t){this.name=e,this.message=t};return t.prototype=new Error,t},f=function(e,t){return function(n){e.call(this,n,t)}},h=function(){this._promise=new _};h.prototype={promise:function(){return this._promise},resolve:function(e){this._promise.isResolved()||this._promise._resolve(e)},reject:function(e){this._promise.isResolved()||(g.isPromise(e)?(e=e.then(function(e){var t=g.defer();return t.reject(e),t.promise()}),this._promise._resolve(e)):this._promise._reject(e))},notify:function(e){this._promise.isResolved()||this._promise._notify(e)}};var p={PENDING:0,RESOLVED:1,FULFILLED:2,REJECTED:3},_=function(e){if(this._value=t,this._status=p.PENDING,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[],e){var n=this,r=e.length;e(function(e){n.isResolved()||n._resolve(e)},r>1?function(e){n.isResolved()||n._reject(e)}:t,r>2?function(e){n.isResolved()||n._notify(e)}:t)}};_.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==p.PENDING},isFulfilled:function(){return this._status===p.FULFILLED},isRejected:function(){return this._status===p.REJECTED},then:function(e,t,n,r){var i=new h;return this._addCallbacks(i,e,t,n,r),i.promise()},"catch":function(e,n){return this.then(t,e,n)},fail:function(e,n){return this.then(t,e,n)},always:function(e,t){var n=this,r=function(){return e.call(this,n)};return this.then(r,r,t)},progress:function(e,n){return this.then(t,t,e,n)},spread:function(e,t,n){return this.then(function(t){return e.apply(this,t)},t,n)},done:function(e,t,n,r){this.then(e,t,n,r).fail(i)},delay:function(e){var t,n=this.then(function(n){var r=new h;return t=setTimeout(function(){r.resolve(n)},e),r.promise()});return n.always(function(){clearTimeout(t)}),n},timeout:function(e){var t=new h,n=setTimeout(function(){t.reject(new g.TimedOutError("timed out"))},e);return this.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().always(function(){clearTimeout(n)}),t.promise()},_vow:!0,_resolve:function(e){if(!(this._status>p.RESOLVED)){if(e===this)return void this._reject(TypeError("Can't resolve promise with itself"));if(this._status=p.RESOLVED,e&&e._vow)return void(e.isFulfilled()?this._fulfill(e.valueOf()):e.isRejected()?this._reject(e.valueOf()):e.then(this._fulfill,this._reject,this._notify,this));if(a(e)||o(e)){var t;try{t=e.then}catch(n){return void this._reject(n)}if(o(t)){var r=this,i=!1;try{t.call(e,function(e){i||(i=!0,r._resolve(e))},function(e){i||(i=!0,r._reject(e))},function(e){r._notify(e)})}catch(n){i||this._reject(n)}return}}this._fulfill(e)}},_fulfill:function(e){this._status>p.RESOLVED||(this._status=p.FULFILLED,this._value=e,this._callCallbacks(this._fulfilledCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=t)},_reject:function(e){this._status>p.RESOLVED||(this._status=p.REJECTED,this._value=e,this._callCallbacks(this._rejectedCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=t)},_notify:function(e){this._callCallbacks(this._progressCallbacks,e)},_addCallbacks:function(e,n,r,i,a){r&&!o(r)?(a=r,r=t):i&&!o(i)&&(a=i,i=t);var s;this.isRejected()||(s={defer:e,fn:o(n)?n:t,ctx:a},this.isFulfilled()?this._callCallbacks([s],this._value):this._fulfilledCallbacks.push(s)),this.isFulfilled()||(s={defer:e,fn:r,ctx:a},this.isRejected()?this._callCallbacks([s],this._value):this._rejectedCallbacks.push(s)),this._status<=p.RESOLVED&&this._progressCallbacks.push({defer:e,fn:i,ctx:a})},_callCallbacks:function(e,t){var n=e.length;if(n){var i=this.isResolved(),o=this.isFulfilled();r(function(){for(var r,a,s,u=0;n>u;)if(r=e[u++],a=r.defer,s=r.fn){var c,d=r.ctx;try{c=d?s.call(d,t):s(t)}catch(l){a.reject(l);continue}i?a.resolve(c):a.notify(c)}else i?o?a.resolve(t):a.reject(t):a.notify(t)})}}};var v={cast:function(e){return g.cast(e)},all:function(e){return g.all(e)},race:function(e){return g.anyResolved(e)},resolve:function(e){return g.resolve(e)},reject:function(e){return g.reject(e)}};for(var y in v)v.hasOwnProperty(y)&&(_[y]=v[y]);var g={Deferred:h,Promise:_,defer:function(){return new h},when:function(e,t,n,r,i){return g.cast(e).then(t,n,r,i)},fail:function(e,n,r){return g.when(e,t,n,r)},always:function(e,t,n){return g.when(e).always(t,n)},progress:function(e,t,n){return g.when(e).progress(t,n)},spread:function(e,t,n,r){return g.when(e).spread(t,n,r)},done:function(e,t,n,r,i){g.when(e).done(t,n,r,i)},isPromise:function(e){return a(e)&&o(e.then)},cast:function(e){return e&&e._vow?e:g.resolve(e)},valueOf:function(e){return e&&o(e.valueOf)?e.valueOf():e},isFulfilled:function(e){return e&&o(e.isFulfilled)?e.isFulfilled():!0},isRejected:function(e){return e&&o(e.isRejected)?e.isRejected():!1},isResolved:function(e){return e&&o(e.isResolved)?e.isResolved():!0},resolve:function(e){var t=g.defer();return t.resolve(e),t.promise()},fulfill:function(e){var t=g.defer(),n=t.promise();return t.resolve(e),n.isFulfilled()?n:n.then(null,function(e){return e})},reject:function(e){var t=g.defer();return t.reject(e),t.promise()},invoke:function(t,n){var r,i=Math.max(arguments.length-1,0);if(i){r=Array(i);for(var o=0;i>o;)r[o++]=arguments[o]}try{return g.resolve(r?t.apply(e,r):t.call(e))}catch(a){return g.reject(a)}},all:function(e){var t=new h,n=u(e),r=n?c(e):d(e),i=r.length,o=n?[]:{};if(!i)return t.resolve(o),t.promise();var a=i;return g._forEach(e,function(e,n){o[r[n]]=e,--a||t.resolve(o)},t.reject,t.notify,t,r),t.promise()},allResolved:function(e){var t=new h,n=u(e),r=n?c(e):d(e),i=r.length,o=n?[]:{};if(!i)return t.resolve(o),t.promise();var a=function(){--i||t.resolve(e)};return g._forEach(e,a,a,t.notify,t,r),t.promise()},allPatiently:function(e){return g.allResolved(e).then(function(){var t,n,r,i,o=u(e),a=o?c(e):d(e),s=a.length,l=0;if(!s)return o?[]:{};for(;s>l;)r=a[l++],i=e[r],g.isRejected(i)?(t||(t=o?[]:{}),o?t.push(i.valueOf()):t[r]=i.valueOf()):t||((n||(n=o?[]:{}))[r]=g.valueOf(i));if(t)throw t;return n})},any:function(e){var t=new h,n=e.length;if(!n)return t.reject(Error()),t.promise();var r,i=0;return g._forEach(e,t.resolve,function(e){i||(r=e),++i===n&&t.reject(r)},t.notify,t),t.promise()},anyResolved:function(e){var t=new h,n=e.length;return n?(g._forEach(e,t.resolve,t.reject,t.notify,t),t.promise()):(t.reject(Error()),t.promise())},delay:function(e,t){return g.resolve(e).delay(t)},timeout:function(e,t){return g.resolve(e).timeout(t)},_forEach:function(e,t,n,r,i,o){for(var a=o?o.length:e.length,s=0;a>s;)g.when(e[o?o[s]:s],f(t,s),n,r,i),++s},TimedOutError:l("TimedOut")},m=!0;"object"==typeof n&&"object"==typeof n.exports&&(n.exports=g,m=!1),"object"==typeof modules&&o(modules.define)&&(modules.define("vow",function(e){e(g)}),m=!1),"function"==typeof define&&(define(function(e,t,n){n.exports=g}),m=!1),m&&(e.vow=g)}("undefined"!=typeof window?window:e),t.vow=n.exports,t.modules.define("vow",function(e){e(t.vow)})}(t),function(e){var t={exports:{}},n={},r=e.vow.Promise;!function(e,r){"object"==typeof n&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.localforage=r():e.localforage=r()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,function(){function e(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function o(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(h(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}function a(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t]===e)return!0;return!1}var s={},u={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},c=[u.INDEXEDDB,u.WEBSQL,u.LOCALSTORAGE],d=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],l={description:"",driver:c.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},f=function(e){var t=t||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB,n={};return n[u.WEBSQL]=!!e.openDatabase,n[u.INDEXEDDB]=!!function(){if("undefined"!=typeof e.openDatabase&&e.navigator&&e.navigator.userAgent&&/Safari/.test(e.navigator.userAgent)&&!/Chrome/.test(e.navigator.userAgent))return!1;try{return t&&"function"==typeof t.open&&"undefined"!=typeof e.IDBKeyRange}catch(n){return!1}}(),n[u.LOCALSTORAGE]=!!function(){try{return e.localStorage&&"setItem"in e.localStorage&&e.localStorage.setItem}catch(t){return!1}}(),n}(this),h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},p=function(){function t(e){i(this,t),this.INDEXEDDB=u.INDEXEDDB,this.LOCALSTORAGE=u.LOCALSTORAGE,this.WEBSQL=u.WEBSQL,this._defaultConfig=o({},l),this._config=o({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}return t.prototype.config=function(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e)"storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),this._config[t]=e[t];return"driver"in e&&e.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof e?this._config[e]:this._config},t.prototype.defineDriver=function(e,t,n){var i=new r(function(t,n){try{var i=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),u=new Error("Custom driver name already in use: "+e._driver);if(!e._driver)return void n(o);if(a(e._driver))return void n(u);for(var c=d.concat("_initStorage"),l=0;l<c.length;l++){var h=c[l];if(!h||!e[h]||"function"!=typeof e[h])return void n(o)}var p=r.resolve(!0);"_support"in e&&(p=e._support&&"function"==typeof e._support?e._support():r.resolve(!!e._support)),p.then(function(n){f[i]=n,s[i]=e,t()},n)}catch(_){n(_)}});return i.then(t,n),i},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(e,t,i){var o=this,u=function(){if(a(e))switch(e){case o.INDEXEDDB:return new r(function(e,t){e(n(1))});case o.LOCALSTORAGE:return new r(function(e,t){e(n(2))});case o.WEBSQL:return new r(function(e,t){e(n(4))})}else if(s[e])return r.resolve(s[e]);return r.reject(new Error("Driver not found."))}();return u.then(t,i),u},t.prototype.getSerializer=function(e){var t=new r(function(e,t){e(n(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},t.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return n.then(e,e),n},t.prototype.setDriver=function(e,t,n){function i(){a._config.driver=a.driver()}function o(e){return function(){function t(){for(;n<e.length;){var o=e[n];return n++,a._dbInfo=null,a._ready=null,a.getDriver(o).then(function(e){return a._extend(e),i(),a._ready=a._initStorage(a._config),a._ready})["catch"](t)}i();var s=new Error("No available storage method found.");return a._driverSet=r.reject(s),a._driverSet}var n=0;return t()}}var a=this;h(e)||(e=[e]);var s=this._getSupportedDrivers(e),u=null!==this._driverSet?this._driverSet["catch"](function(){return r.resolve()}):r.resolve();return this._driverSet=u.then(function(){var e=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,i(),a._wrapLibraryMethodsWithReady(),a._initDriver=o(s)})})["catch"](function(){i();var e=new Error("No available storage method found.");return a._driverSet=r.reject(e),a._driverSet}),this._driverSet.then(t,n),this._driverSet},t.prototype.supports=function(e){return!!f[e]},t.prototype._extend=function(e){o(this,e)},t.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;r>n;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<d.length;t++)e(this,d[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),_=new p;t["default"]=_}.call("undefined"!=typeof window?window:self),e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,function(){function e(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var r=x.BlobBuilder||x.MSBlobBuilder||x.MozBlobBuilder||x.WebKitBlobBuilder,i=new r,o=0;o<e.length;o+=1)i.append(e[o]);return i.getBlob(t.type)}}function n(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;t>i;i++)r[i]=e.charCodeAt(i);return n}function i(e){return new r(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.withCredentials=!0,r.responseType="arraybuffer",r.onreadystatechange=function(){return 4===r.readyState?200===r.status?t({response:r.response,type:r.getResponseHeader("Content-Type")}):void n({status:r.status,response:r.response}):void 0},r.send()})}function o(t){return new r(function(n,r){var o=e([""],{type:"image/png"}),a=t.transaction([O],"readwrite");a.objectStore(O).put(o,"key"),a.oncomplete=function(){var e=t.transaction([O],"readwrite"),o=e.objectStore(O).get("key");o.onerror=r,o.onsuccess=function(e){var t=e.target.result,r=URL.createObjectURL(t);i(r).then(function(e){n(!(!e||"image/png"!==e.type))},function(){n(!1)}).then(function(){URL.revokeObjectURL(r)})}}})["catch"](function(){return!1})}function a(e){return"boolean"==typeof R?r.resolve(R):o(e).then(function(e){return R=e})}function s(e){return new r(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function u(t){var r=n(atob(t.data));return e([r],{type:t.type})}function c(e){return e&&e.__local_forage_encoded_blob}function d(e){function t(){return r.resolve()}var n=this,i={db:null};if(e)for(var o in e)i[o]=e[o];k||(k={});var a=k[i.name];a||(a={forages:[],db:null},k[i.name]=a),a.forages.push(this);for(var s=[],u=0;u<a.forages.length;u++){var c=a.forages[u];c!==this&&s.push(c.ready()["catch"](t))}var d=a.forages.slice(0);return r.all(s).then(function(){return i.db=a.db,l(i)}).then(function(e){return i.db=e,p(i,n._defaultConfig.version)?f(i):e}).then(function(e){i.db=a.db=e,n._dbInfo=i;for(var t in d){var r=d[t];r!==n&&(r._dbInfo.db=i.db,r._dbInfo.version=i.version)}})}function l(e){return h(e,!1)}function f(e){return h(e,!0)}function h(e,t){return new r(function(n,r){if(e.db){if(!t)return n(e.db);e.db.close()}var i=[e.name];t&&i.push(e.version);var o=I.open.apply(I,i);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(O)}catch(r){if("ConstraintError"!==r.name)throw r;x.console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(){r(o.error)},o.onsuccess=function(){n(o.result)}})}function p(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&x.console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function _(e,t){var n=this;"string"!=typeof e&&(x.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo,o=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),a=o.get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),c(e)&&(e=u(e)),t(e)},a.onerror=function(){r(a.error)}})["catch"](r)});return S(i,t),i}function v(e,t){var n=this,i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo,o=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),a=o.openCursor(),s=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;c(r)&&(r=u(r));var i=e(r,n.key,s++);void 0!==i?t(i):n["continue"]()}else t()},a.onerror=function(){r(a.error)}})["catch"](r)});return S(i,t),i}function y(e,t,n){var i=this;"string"!=typeof e&&(x.console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=new r(function(n,r){var o;i.ready().then(function(){return o=i._dbInfo,a(o.db)}).then(function(e){return!e&&t instanceof Blob?s(t):t}).then(function(t){var i=o.db.transaction(o.storeName,"readwrite"),a=i.objectStore(o.storeName);null===t&&(t=void 0);var s=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;r(e)}})["catch"](r)});return S(o,n),o}function g(e,t){var n=this;"string"!=typeof e&&(x.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo,o=i.db.transaction(i.storeName,"readwrite"),a=o.objectStore(i.storeName),s=a["delete"](e);o.oncomplete=function(){t()},o.onerror=function(){r(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;r(e)}})["catch"](r)});return S(i,t),i}function m(e){var t=this,n=new r(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readwrite"),o=i.objectStore(r.storeName),a=o.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}})["catch"](n)});return S(n,e),n}function b(e){var t=this,n=new r(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),o=i.count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}})["catch"](n)});return S(n,e),n}function w(e,t){var n=this,i=new r(function(t,r){return 0>e?void t(null):void n.ready().then(function(){var i=n._dbInfo,o=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),a=!1,s=o.openCursor();s.onsuccess=function(){var n=s.result;return n?void(0===e?t(n.key):a?t(n.key):(a=!0,n.advance(e))):void t(null)},s.onerror=function(){r(s.error)}})["catch"](r)});return S(i,t),i}function E(e){var t=this,n=new r(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),o=i.openCursor(),a=[];o.onsuccess=function(){var t=o.result;return t?(a.push(t.key),void t["continue"]()):void e(a)},o.onerror=function(){n(o.error)}})["catch"](n)});return S(n,e),n}function S(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var x=this,I=I||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(I){var R,k,O="local-forage-detect-blob-support",D={_driver:"asyncStorage",_initStorage:d,iterate:v,getItem:_,setItem:y,removeItem:g,clear:m,length:b,key:w,keys:E};t["default"]=D}}.call("undefined"!=typeof window?window:self),e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0,function(){function e(e){var t=this,i={};if(e)for(var o in e)i[o]=e[o];return i.keyPrefix=i.name+"/",i.storeName!==t._defaultConfig.storeName&&(i.keyPrefix+=i.storeName+"/"),t._dbInfo=i,new r(function(e,t){e(n(3))}).then(function(e){return i.serializer=e,r.resolve()})}function i(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=p.length-1;n>=0;n--){var r=p.key(n);0===r.indexOf(e)&&p.removeItem(r)}});return f(n,e),n}function o(e,t){var n=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var r=n.ready().then(function(){var t=n._dbInfo,r=p.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return f(r,t),r}function a(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=p.length,a=1,s=0;o>s;s++){var u=p.key(s);if(0===u.indexOf(r)){var c=p.getItem(u);if(c&&(c=t.serializer.deserialize(c)),c=e(c,u.substring(i),a++),void 0!==c)return c}}});return f(r,t),r}function s(e,t){var n=this,r=n.ready().then(function(){var t,r=n._dbInfo;try{t=p.key(e)}catch(i){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return f(r,t),r}function u(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=p.length,r=[],i=0;n>i;i++)0===p.key(i).indexOf(e.keyPrefix)&&r.push(p.key(i).substring(e.keyPrefix.length));return r});return f(n,e),n}function c(e){var t=this,n=t.keys().then(function(e){return e.length});return f(n,e),n}function d(e,t){var n=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var r=n.ready().then(function(){var t=n._dbInfo;p.removeItem(t.keyPrefix+e)});return f(r,t),r}function l(e,t,n){var i=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=i.ready().then(function(){void 0===t&&(t=null);var n=t;return new r(function(r,o){var a=i._dbInfo;a.serializer.serialize(t,function(t,i){if(i)o(i);else try{p.setItem(a.keyPrefix+e,t),r(n)}catch(s){("QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&o(s),o(s)}})})});return f(o,n),o}function f(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var h=this,p=null;try{if(!(this.localStorage&&"setItem"in this.localStorage))return;p=this.localStorage}catch(_){return}var v={_driver:"localStorageWrapper",_initStorage:e,iterate:a,getItem:o,setItem:l,removeItem:d,clear:i,length:c,key:s,keys:u};t["default"]=v}.call("undefined"!=typeof window?window:self),e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,function(){function e(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var r=S.BlobBuilder||S.MSBlobBuilder||S.MozBlobBuilder||S.WebKitBlobBuilder,i=new r,o=0;o<e.length;o+=1)i.append(e[o]);return i.getBlob(t.type)}}function n(e,t){var n="";if(e&&(n=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var r,i=c;e instanceof ArrayBuffer?(r=e,i+=l):(r=e.buffer,"[object Int8Array]"===n?i+=h:"[object Uint8Array]"===n?i+=p:"[object Uint8ClampedArray]"===n?i+=_:"[object Int16Array]"===n?i+=v:"[object Uint16Array]"===n?i+=g:"[object Int32Array]"===n?i+=y:"[object Uint32Array]"===n?i+=m:"[object Float32Array]"===n?i+=b:"[object Float64Array]"===n?i+=w:t(new Error("Failed to get type for BinaryArray"))),t(i+o(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n=s+e.type+"~"+o(this.result);t(c+f+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(u){console.error("Couldn't convert value into a JSON string: ",e),t(null,u)}}function r(t){if(t.substring(0,d)!==c)return JSON.parse(t);var n,r=t.substring(E),o=t.substring(d,E);if(o===f&&u.test(r)){var a=r.match(u);n=a[1],r=r.substring(a[0].length)}var s=i(r);switch(o){case l:return s;case f:return e([s],{type:n});case h:return new Int8Array(s);case p:return new Uint8Array(s);case _:return new Uint8ClampedArray(s);case v:return new Int16Array(s);case g:return new Uint16Array(s);case y:return new Int32Array(s);case m:return new Uint32Array(s);case b:return new Float32Array(s);case w:return new Float64Array(s);default:throw new Error("Unkown type: "+o)}}function i(e){var t,n,r,i,o,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var d=new ArrayBuffer(s),l=new Uint8Array(d);for(t=0;u>t;t+=4)n=a.indexOf(e[t]),r=a.indexOf(e[t+1]),i=a.indexOf(e[t+2]),o=a.indexOf(e[t+3]),l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return d}function o(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=a[n[t]>>2],r+=a[(3&n[t])<<4|n[t+1]>>4],r+=a[(15&n[t+1])<<2|n[t+2]>>6],r+=a[63&n[t+2]];return n.length%3===2?r=r.substring(0,r.length-1)+"=":n.length%3===1&&(r=r.substring(0,r.length-2)+"=="),r}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="~~local_forage_type~",u=/^~~local_forage_type~([^~]+)~/,c="__lfsc__:",d=c.length,l="arbf",f="blob",h="si08",p="ui08",_="uic8",v="si16",y="si32",g="ur16",m="ui32",b="fl32",w="fl64",E=d+l.length,S=this,x={serialize:n,deserialize:r,stringToBuffer:i,bufferToString:o};t["default"]=x}.call("undefined"!=typeof window?window:self),e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0,function(){function e(e){var t=this,i={db:null};if(e)for(var o in e)i[o]="string"!=typeof e[o]?e[o].toString():e[o];var a=new r(function(n,r){try{i.db=p(i.name,String(i.version),i.description,i.size)}catch(o){return t.setDriver(t.LOCALSTORAGE).then(function(){return t._initStorage(e)}).then(n)["catch"](r)}i.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+i.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=i,n()},function(e,t){r(t)})})});return new r(function(e,t){e(n(3))}).then(function(e){return i.serializer=e,a})}function i(e,t){var n=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})})["catch"](r)});return f(i,t),i}function o(e,t){var n=this,i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName,[],function(n,r){for(var o=r.rows,a=o.length,s=0;a>s;s++){var u=o.item(s),c=u.value;if(c&&(c=i.serializer.deserialize(c)),c=e(c,u.key,s+1),void 0!==c)return void t(c)}t()},function(e,t){r(t)})})})["catch"](r)});return f(i,t),i}function a(e,t,n){var i=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=new r(function(n,r){i.ready().then(function(){void 0===t&&(t=null);var o=t,a=i._dbInfo;a.serializer.serialize(t,function(t,i){i?r(i):a.db.transaction(function(i){i.executeSql("INSERT OR REPLACE INTO "+a.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){n(o)},function(e,t){r(t)})},function(e){e.code===e.QUOTA_ERR&&r(e)})})})["catch"](r)});return f(o,n),o}function s(e,t){var n=this;"string"!=typeof e&&(h.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})})["catch"](r)});return f(i,t),i}function u(e){var t=this,n=new r(function(e,n){
t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})})["catch"](n)});return f(n,e),n}function c(e){var t=this,n=new r(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})})["catch"](n)});return f(n,e),n}function d(e,t){var n=this,i=new r(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})})["catch"](r)});return f(i,t),i}function l(e){var t=this,n=new r(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})})["catch"](n)});return f(n,e),n}function f(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var h=this,p=this.openDatabase;if(p){var _={_driver:"webSQLStorage",_initStorage:e,iterate:o,getItem:i,setItem:a,removeItem:s,clear:u,length:c,key:d,keys:l};t["default"]=_}}.call("undefined"!=typeof window?window:self),e.exports=t["default"]}])}),e.localForage=t.exports,e.modules.define("localForage",function(t){t(e.localForage)})}(t),t.modules.define("cloud.Error",["component.util"],function(e,t){var n={400:"Bad Request",401:"Not Authorized",403:"Forbidden",404:"Not Found",409:"Conflict",410:"Gone",421:"Locked",423:"Too Many Requests",500:"Internal Server Error"},r=function(e){t.extend(this,{code:400},e),this.message||(this.message=n[this.code]),Error.captureStackTrace?Error.captureStackTrace(this,r):this.stack=(new Error).stack};t.defineClass(r,Error,{toString:function(){return this.code+" "+this.message}}),e(r)});var n=function(){this._initialized=!1,this._key=null,this._token=null};if(n.prototype.initialize=function(e){var n=t.vow.defer();return t.modules.require(["cloud.dataSyncApi.config","component.util","cloud.Error","vow","global"],function(t,r,i,o,a){if(e)if(e.key||e.token||e.with_credentials)if(e.token)this._token=e.token,this._initialized=!0,n.resolve();else if(e.with_credentials)this._withCredentials=!0,this._initialized=!0,n.resolve();else{var s=a.open(t.oauthLoginPage.replace(/{{\s*key\s*}}/g,e.key),"oauth",t.oauthWindowParameters);if(s)var u=a.setInterval(function(){if(s.closed)a.clearInterval(u),n.reject(new i({code:401}));else try{var e=s.location.hash.match(/access_token=([0-9a-f]+)/);e&&(this._token=e[1],this._initialized=!0,s.close(),a.clearInterval(u),n.resolve(this._token))}catch(t){}}.bind(this),100);else n.reject(new i({code:401}))}else n.reject(new i({message:"Either `options.key` or `options.token` Parameter Required"}));else n.reject(new i({message:"`options` Parameter Required"}))}.bind(this)),n.promise()},n.prototype.isInitialized=function(){return this._initialized},n.prototype.isInitiaized=n.prototype.isInitialized,n.prototype.getToken=function(){return this._token},n.prototype.withCredentials=function(){return this._withCredentials},t.cloud.client=new n,t.modules.define("cloud.client",[],function(e){e(t.cloud.client)}),t.cloud.dataSyncApi={openDatabase:function(e){return this._require(["cloud.dataSyncApi.Database"]).spread(function(t){return new t(e)})},getDatabaseCount:function(e){return this._require(["component.util","cloud.dataSyncApi.http"]).spread(function(t,n){return n.getDatabases(t.extend({limit:0,offset:0},e)).then(function(e){return e.data.total})})},getDatabaseMetadata:function(e){if(!e||!e.database_id)return this._fail("`options.database_id` Parameter Required");var t=this._castMetadata.bind(this);return this._require(["cloud.dataSyncApi.http"]).spread(function(n){return n.getDatabases(e).then(function(e){return t(e.data)})})},listDatabaseMetadata:function(e){if(!e||"undefined"==typeof e.offset||"undefined"==typeof e.limit)return this._fail("`options.offset` and `options.limit` Parameters Required");var t=this._castMetadata.bind(this);return this._require(["cloud.dataSyncApi.http"]).spread(function(n){return n.getDatabases(e).then(function(e){return e.data.items.map(t)})})},createDatabase:function(e){var t=this._fail.bind(this);return this._require(["cloud.dataSyncApi.http"]).spread(function(n){return n.putDatabase(e).then(function(n){return e&&!e.ignore_existing&&200==n.code?t(409,'Database "'+e.database_id+'" Already Exists'):Number(n.headers.etag)},this)})},deleteDatabase:function(e){return this._require(["cloud.dataSyncApi.http"]).spread(function(t){return t.deleteDatabase(e).then(function(){return null})})},_require:function(e){var n=t.vow.defer();return t.modules.require(e,function(){n.resolve([].slice.call(arguments))}),n.promise()},_castMetadata:function(e){return{database_id:e.database_id,revision:e.revision,title:e.title,created:new Date(e.created),modified:new Date(e.modified),records_count:e.records_count,size:e.size}},_fail:function(e,n){n||(n=e,e=400);var r=t.vow.defer();return t.modules.require(["cloud.Error"],function(t){r.reject(new t({code:e,message:n}))}),r.promise()}},t.modules.define("cloud.dataSyncApi",[],function(e){e(t.cloud.dataSyncApi)}),t.modules.define("component.util",function(e){var t={augment:function(e,n,r){return e.prototype=(Object.create||function(e){function t(){}return t.prototype=e,new t})(n.prototype),e.prototype.constructor=e,e.superclass=n.prototype,e.superclass.constructor=n,r&&t.extend(e.prototype,r),e.prototype},extend:function(e){for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];if(r)for(var i=Object.keys(r),o=0,a=i.length;a>o;o++)e[i[o]]=r[i[o]]}return e},defineClass:function(e){var n=1,r="function"==typeof arguments[n]?arguments[n++]:null;r&&t.augment(e,r);for(var i=arguments.length;i>n;)t.extend(e.prototype,arguments[n++]);return e}};e(t)}),t.modules.define("component.xhr",["global","vow","cloud.Error","cloud.dataSyncApi.config"],function(e,t,n,r,i){var o=t.XMLHttpRequest,a=function(e){return e.split("\r\n").reduce(function(e,t){var n=t.split(": ");return 2==n.length&&(e[n[0].toLowerCase()]=n[1].trim()),e},{})};e(function(e,i){i=i||{},i.queryParams&&(e+=(-1==e.indexOf("?")?"?":"&")+Object.keys(i.queryParams).map(function(e){return e+"="+t.encodeURIComponent(i.queryParams[e])}).join("&"));var s=n.defer(),u=new o,c=i.headers||{},d=i.method||"GET";return"GET"==d||c["Content-Type"]||(c["Content-Type"]="application/json"),c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest"),u.onload=function(){var e={code:this.status,data:this.responseText,headers:"undefined"==typeof i.parseResponseHeaders||i.parseResponseHeaders?a(this.getAllResponseHeaders()):this.getAllResponseHeaders()};if(i.parse)try{e.data=JSON.parse(e.data)}catch(t){s.reject(new r({message:"JSON Parse Error "+e.data}))}s.resolve(e)},u.onerror=function(){s.reject(new r({code:500}))},u.open(d,e,!0),Object.keys(c).forEach(function(e){u.setRequestHeader(e,c[e])}),i.withCredentials&&(u.withCredentials=!0),"undefined"!=typeof i.data?u.send("string"==typeof i.data?i.data:JSON.stringify(i.data)):u.send(),s.promise().timeout(i.timeout||3e4).fail(function(e){throw e instanceof n.TimedOutError?new r({code:500,message:"Timeout Exceeded"}):e})})}),t.modules.define("cloud.dataSyncApi.Conflict",["component.util"],function(e,t){var n=function(e){this._type=e.type,this._fieldChangeConflicts=e.field_change_conflicts};t.defineClass(n,{getType:function(){return this._type},getFieldChangeConflicts:function(){return this._fieldChangeConflicts}}),e(n)}),t.modules.define("cloud.dataSyncApi.Database",["cloud.dataSyncApi.config","cloud.dataSyncApi.http","cloud.client","cloud.dataSyncApi.DatasetController","cloud.dataSyncApi.Transaction","cloud.dataSyncApi.Operation","cloud.dataSyncApi.politics","cloud.Error","component.util","vow","localForage"],function(e,t,n,r,i,o,a,s,u,c,d,l){function f(e,t,n){var r=t.operations,i=e.dryRun(t.base_revision,r);return conflicts=i.conflicts,conflicts.length&&n&&(r=s[n](r,conflicts),i=e.dryRun(t.base_revision,r),conflicts=i.conflicts),{operations:r,conflicts:conflicts,revisionHistory:i.revisionHistory}}var h=function(e){return this._id=e.database_id,this._context=e.context,this._token=e.token,this._locked=!0,this._datasetController=null,this._pendingCallbacks=[],this._possiblyMissedDelta=null,this._missedDelta=null,this._listeners={update:[]},i.create(e).then(function(e){return this._datasetController=e,this._locked=!1,this},null,this)};c.defineClass(h,{on:function(e,t){if("undefined"==typeof this._listeners[e])throw new u({message:"Event `"+e+"` is not supported"});if("function"!=typeof t)throw new u({message:"`callback` parameter must be a function"});return this._listeners[e].push(t),this},off:function(e,t){if("undefined"==typeof this._listeners[e])throw new u({message:"Event `"+e+"` is not supported"});var n=this._listeners[e].indexOf(t);if(-1==n)throw new u({code:404,message:"Callback not found"});return this._listeners[e].splice(n,1),this},_notify:function(e,t){var n=(this._listeners[e]||[]).slice();n.forEach(function(e){e(t)})},update:function(){return this._executeExclusiveTask(this._explicitUpdate.bind(this))},_explicitUpdate:function(){var e=this.getRevision();return this._datasetController.update({possiblyMissedDelta:this._possiblyMissedDelta}).then(function(t){return t.missedDeltaFound&&(this._missedDelta=this._possiblyMissedDelta,this._possiblyMissedDelta=null),t.revision!=e&&this._notify("update",t.revision),t.revision},null,this)},_executeExclusiveTask:function(e){var t=this._datasetController.isGone();if(t)return t;var n=d.defer();return this._pendingCallbacks.push([e,n]),this._locked||this._proceedPendingQueue(),n.promise()},_proceedPendingQueue:function(){var e=this._pendingCallbacks.shift(),t=e[0],n=e[1];this._locked=!0,t().then(function(e){n.resolve(e),this._locked=!1,this._pendingCallbacks.length&&this._proceedPendingQueue()},function(e){n.reject(e),this._locked=!1,this._pendingCallbacks.length&&this._proceedPendingQueue()},this)},getRevision:function(){return this._datasetController.getDataset().getRevision()},getDatabaseId:function(){return this._id},createTransaction:function(){return new o(this,function(e,t){return this._executeExclusiveTask(this._patch.bind(this,e,t))}.bind(this))},_patch:function(e,t){var n=d.defer(),r=this._datasetController.getDataset(),i=e.delta_id,o=function(){n.resolve(r.getRevision())},s=function(e){e.postDeltaFail&&(this._possiblyMissedDelta=e.postDeltaFail),n.reject(e)}.bind(this);if(this._missedDelta&&i==this._missedDelta)this._missedDelta=null,o();else{var c=f(r,e,t),l=c.operations,h=c.conflicts,p=c.revisionHistory,_={base_revision:this.getRevision(),delta_id:e.delta_id,changes:l.map(a.json.serialize)};h.length?s(new u({code:409,conflicts:h,revisionHistory:p})):l.length?this._postDeltas({database_id:this._id,delta_id:i,base_revision:this.getRevision(),context:this._context,token:this._token,data:_}).then(function(e){_.revision=e,r.applyDeltas([_]),o(),this._notify("update",e)},function(n){409==n.code?this._explicitUpdate().then(function(){this._patch(e,t).then(o,s)},s,this):s(n)},this):o()}return n.promise()},_postDeltas:function(e){var t=d.defer(),r=function(e){t.reject(e)};return n.postDeltas(e).then(function(n){200==n.code||201==n.code?t.resolve(Number(n.headers.etag)):(n.code>=500&&(n.postDeltaFail=e.delta_id),r(new u(n)))},function(t){t.postDeltaFail=e.delta_id,r(t)},this),t.promise()},getRecord:function(e,t){return this._datasetController.getDataset().getRecord(e,t)},getRecordsCount:function(){return this._datasetController.getDataset().getLength()},iterator:function(e){return this._datasetController.getDataset().iterator(e)},forEach:function(e,t,n){"string"!=typeof e&&(n=t,t=e,e=null);for(var r=this._datasetController.getDataset().iterator(e),i=r.next(),o=0;!i.done;)t.call(n||null,i.value,o++),i=r.next();return this},filter:function(e,t,n){this.forEach(function(r,i){e(r,i)&&t.call(n||null,r,i)})}}),e(h)}),t.modules.define("cloud.dataSyncApi.Dataset",["cloud.dataSyncApi.Record","cloud.dataSyncApi.Operation","cloud.dataSyncApi.FieldOperation","cloud.dataSyncApi.Conflict","cloud.Error","component.util"],function(e,t,n,r,i,o,a){function s(e){return Object.keys(e).reduce(function(t,n){return t[n]=Object.keys(e[n]).reduce(function(e,t){return e[t]=!0,e},{}),t},{})}function u(e){return e.map(function(e){return n.json.deserialize(e)})}var c=function(e,n){var r=this._index={};this._revision=Number(e),this._revisionHistory=[],this._records=n.map(function(e){e instanceof t||(e=new t(e));var n=e.getCollectionId(),i=e.getRecordId();if(r[n]||(r[n]={}),r[n][i])throw new o({message:"Record with `collection_id` and `record_id` provided already exists",collection_id:n,record_id:i});return r[n][i]=e,e})};c.json={deserialize:function(e){return new c(e.revision,e.records.items.map(function(e){return t.json.deserialize(e)}))},serialize:function(e){for(var n=[],r=e.iterator(),i=r.next();!i.done;)n.push(t.json.serialize(i.value)),i=r.next();return{revision:e.getRevision(),records:{items:n}}}},a.defineClass(c,{getRecord:function(e,t){if(!e)throw new o({message:"`collection_id` Parameter Required"});if(!t)throw new o({message:"`record_id` Parameter Required"});return this._index[e]&&this._index[e][t]},getRevision:function(){return this._revision},getLength:function(){return this._records.length},iterator:function(e){var t=-1,n=this._records;return{next:function(){if(e){do t++;while(t<n.length&&n[t].getCollectionId()!=e)}else t++;return t<n.length?{value:n[t]}:{done:!0}}}},applyDeltas:function(e){var n=this._index,i=this._revisionHistory,a=this._revision;e.forEach(function(e){var s={};if(e.base_revision!=a)throw new o({message:"Incorrect delta base_revision"});e.changes.forEach(function(e){var i=e.collection_id,o=e.record_id;switch(s[i]||(s[i]={}),s[i][o]=!0,e.change_type){case"insert":case"set":n[i]||(n[i]={}),n[i][o]=t.json.deserialize(e,!0);break;case"delete":delete n[i][o];break;case"update":var a=n[i][o];e.changes.forEach(function(e){a.applyFieldOperation(r.json.deserialize(e))})}}),i.push({base_revision:e.base_revision,delta_id:e.delta_id,revision:e.revision,alteredRecords:s,changes:e.changes}),a=e.revision});var s=this._records=[];Object.keys(n).forEach(function(e){Object.keys(n[e]).forEach(function(t){s.push(n[e][t])})}),this._revision=a},ifModifiedSince:function(e){var t=e.collection_id,n=e.record_id,r=e.revision,i=this._locateRevision(r);if(-1!=i)for(var o=i;o<this._revisionHistory.length;o++){var a=this._revisionHistory[o];if(a.alteredRecords[t]&&a.alteredRecords[t][n])return!0}return!1},_locateRevision:function(e){for(var t=0;t<this._revisionHistory.length;t++)if(this._revisionHistory[t].base_revision==e)return t;return-1},dryRun:function(e,r){var o=[],a=s(this._index),u=this._index;return r.forEach(function(r,s){var c=r.getCollectionId(),d=r.getRecordId();if(this.ifModifiedSince({collection_id:c,record_id:d,revision:e}))o.push({index:s,conflict:new i({type:"both_modified",operation:r})});else switch(r.getType()){case"insert":a[c]&&a[c][d]?o.push({index:s,conflict:new i({type:"record_already_exists",operation:r})}):(a[c]||(a[c]={}),a[c][d]=t.json.deserialize(n.json.serialize(r),!0));break;case"set":a[c]||(a[c]={}),a[c][d]=t.json.deserialize(n.json.serialize(r),!0);break;case"delete":a[c]&&a[c][d]?delete a[c][d]:o.push({index:s,conflict:new i({type:"delete_non_existent_record",operation:r})});break;case"update":if(a[c]&&a[c][d]){var l=a[c][d],f=[];l===!0&&(l=u[c][d].copy()),r.getFieldOperations().forEach(function(e,t){var n=l.dryRun(e);n?f.push({type:n,index:t}):l.applyFieldOperation(e)}),f.length?o.push({index:s,conflict:new i({type:"invalid_field_change",operation:r,field_change_conflicts:f})}):a[c][d]=l}else o.push({index:s,conflict:new i({type:"update_non_existent_record",operation:r})})}},this),{conflicts:o,revisionHistory:o.length?this._getRevisionHistory(e):[]}},_getRevisionHistory:function(e){var t=this._locateRevision(e);if(-1!=t){for(var n=[],r=t;r<this._revisionHistory.length;r++){var i=this._revisionHistory[r];n.push({base_revision:i.base_revision,revision:i.revision,delta_id:i.delta_id,operations:u(i.changes)})}return n}return[]}}),e(c)}),t.modules.define("cloud.dataSyncApi.DatasetController",["cloud.dataSyncApi.config","cloud.dataSyncApi.http","cloud.dataSyncApi.Dataset","cloud.Error","component.util","vow","localForage"],function(e,t,n,r,i,o,a,s){function u(e,r){var s=[],u=a.defer(),c=function(e){u.reject(e)},d=function(r){return n.getDeltas(o.extend({},e,{base_revision:r,limit:t.deltaLimit})).then(function(e){if(200==e.code)return e.data;throw new i({code:e.code})})},l=function(e){var t=e.revision;s.push(e.items);var n=e.items.length?e.items[e.items.length-1].revision:t;n==t?f():d(n).then(l,c)},f=function(){s=[].concat.apply([],s),u.resolve(s)};return d(r).then(l,c),u.promise()}var c=function(e){return this._options=e||{},this._gone=!1,this._updatePromise=null,this._dataset=null,this._prefix=t.storagePrefix+"_"+this._options.context+"_",this._createDataset().then(function(){return this},null,this)};c.create=function(e){return new c(e)},o.defineClass(c,{getDataset:function(){return this._dataset},isGone:function(){return this._gone},_createDataset:function(){return n.putDatabase(this._options).then(function(e){if(200!=e.code&&201!=e.code)throw new i({code:e.code});return this._getSnapshot(e.data)},null,this)},_getSnapshot:function(e){var t=this._options,n=this._getHttpSnapshot.bind(this),r=this._initDataset.bind(this),i=a.defer();return e.handle&&t.use_client_storage?(this._databaseHandle=e.handle,s.getItem(this._prefix+e.handle,function(e,o){try{o=JSON.parse(o)}catch(a){o=null}e||!o?i.resolve(n(t)):i.resolve(r(o,{needUpdate:!0}))})):i.resolve(n(t)),i.promise()},_getHttpSnapshot:function(){return n.getSnapshot(this._options).then(function(e){if(200==e.code)return this._initDataset(e.data);throw 410==e.code&&this._onGone(),new i({code:e.code})},null,this)},_initDataset:function(e,t){var n=a.defer();return this._dataset=r.json.deserialize(e),t&&t.need_update?this.update().then(function(){n.resolve()},function(e){410==e.code?n.resolve(this._getHttpSnapshot(options)):n.reject(e)},this):(this._options.use_client_storage&&this._saveSnapshot(),n.resolve()),n.promise()},_saveSnapshot:function(){this._options.use_client_storage&&this._databaseHandle&&s.setItem(this._prefix+this._databaseHandle,JSON.stringify(r.json.serialize(this._dataset)))},update:function(e){return this._gone?this._gone:(this._updatePromise||(this._updatePromise=this._applyDeltas(e).then(function(e){return this._saveSnapshot(),this._updatePromise=null,e},function(e){throw 410==e.code&&this._onGone(),this._updatePromise=null,e},this)),this._updatePromise)},_applyDeltas:function(e){var t=this._dataset;return u(this._options,t.getRevision()).then(function(n){n.length&&t.applyDeltas(n);var r=!1;return e&&e.possiblyMissedDelta&&n.forEach(function(t){t.delta_id==e.possiblyMissedDelta&&(r=!0)}),{revision:t.getRevision(),missedDeltaFound:r}})},_onGone:function(){this._gone=a.reject({code:410,message:"Database snapshot outdated"})}}),e(c)}),t.modules.define("cloud.dataSyncApi.FieldOperation",["component.util","cloud.dataSyncApi.Value"],function(e,t,n){var r=function(e){this._type=e.type,this._fieldId=e.field_id,-1!=["set","list_item_set","list_item_insert"].indexOf(this._type)?this._value=e.value instanceof n?e.value:new n(e.value):this._value=null,-1!=["list_item_set","list_item_delete","list_item_insert","list_item_move"].indexOf(this._type)?this._index=Math.floor(e.index):this._index=null,"list_item_move"==this._type?this._newIndex=Math.floor(e.new_index):this._newIndex=null};r.json={serialize:function(e){var t=e.getType(),r={field_id:e.getFieldId(),change_type:t};return("set"==t||"list_item_set"==t||"list_item_insert"==t)&&(r.value=n.json.serialize(e.getValue())),"list_item_move"==t&&(r.list_item_dest=e.getNewIndex()),0==t.indexOf("list_item_")&&(r.list_item=e.getIndex()),r},deserialize:function(e){var t=e.change_type,i={type:t,field_id:e.field_id};return("set"==t||"list_item_set"==t||"list_item_insert"==t)&&(i.value=n.json.deserialize(e.value)),"list_item_move"==t&&(i.new_index=e.list_item_dest),0==t.indexOf("list_item_")&&(i.index=e.list_item),new r(i)}},t.defineClass(r,{getType:function(){return this._type},getFieldId:function(){return this._fieldId},getValue:function(){return this._value},getIndex:function(){return this._index},getNewIndex:function(){return this._newIndex}}),e(r)}),t.modules.define("cloud.dataSyncApi.Operation",["cloud.dataSyncApi.FieldOperation","cloud.dataSyncApi.Record","component.util"],function(e,t,n,r){var i=function(e){this._type=e.type,this._collectionId=e.collection_id,this._recordId=e.record_id,-1!=["insert","update","set"].indexOf(this._type)?this._fieldOperations=(e.field_operations||[]).map(function(e){return e instanceof t?e:new t(e)}):this._fieldOperations=null};i.json={serialize:function(e){var n=e.getType(),r={record_id:e.getRecordId(),collection_id:e.getCollectionId(),change_type:n};return-1!=["insert","update","set"].indexOf(n)&&(r.changes=e.getFieldOperations().map(function(e){return t.json.serialize(e)})),r},deserialize:function(e){var n=e.change_type,r={type:n,record_id:e.record_id,collection_id:e.collection_id};return-1!=["insert","update","set"].indexOf(this._type)&&(r.field_changes=e.changes.map(function(e){return t.json.deserialize(e)})),new i(r)}},r.defineClass(i,{getType:function(){return this._type},getRecordId:function(){return this._recordId},getCollectionId:function(){return this._collectionId},getFieldOperations:function(){return this._fieldOperations?this._fieldOperations.slice():null}}),e(i)}),t.modules.define("cloud.dataSyncApi.Record",["cloud.Error","component.util","cloud.dataSyncApi.Value"],function(e,t,n,r){var i=function(e){this._collectionId=e.collection_id,this._recordId=e.record_id,this._fields=Object.keys(e.fields||{}).reduce(function(t,n){return t[n]=e.fields[n]instanceof r?e.fields[n]:new r(e.fields[n]),t},{})};i.json={deserialize:function(e,n){return new i(n||!e.fields?{collection_id:e.collection_id,record_id:e.record_id,fields:(e.changes||[]).reduce(function(e,n){if("set"!=n.change_type)throw new t({message:"Field change type is not supported",type:n.change_type});return e[n.field_id]=r.json.deserialize(n.value),e},{})}:{collection_id:e.collection_id,record_id:e.record_id,fields:e.fields.reduce(function(e,t){return e[t.field_id]=r.json.deserialize(t.value),e},{})})},serialize:function(e){return{record_id:e.getRecordId(),collection_id:e.getCollectionId(),change_type:"set",changes:e.getFieldIds().map(function(t){return{field_id:t,change_type:"set",value:r.json.serialize(e.getFieldValue(t))}})}}},n.defineClass(i,{getCollectionId:function(){return this._collectionId},getRecordId:function(){return this._recordId},getFieldIds:function(){return Object.keys(this._fields)},getFieldValue:function(e){return this._fields[e]},getFields:function(){return n.extend({},this._fields)},applyFieldOperation:function(e){var n=this.dryRun(e);if(n)throw new t({code:409,type:n});var r=e.getFieldId(),i=e.getType(),o=this._fields,a=o[r];return"set"==i?this._fields[r]=e.getValue():"delete"==i?delete this._fields[r]:-1!=["list_item_set","list_item_delete","list_item_insert","list_item_move"].indexOf(i)&&a.applyListOperation(e),this},copy:function(){var e=this._fields;return new i({collection_id:this.getCollectionId(),record_id:this.getRecordId(),fields:Object.keys(this._fields).reduce(function(t,n){return t[n]=e[n].copy(),t},{})})},dryRun:function(e){var t=e.getFieldId(),n=e.getType(),r=this._fields,i=r[t];return"set"==n?null:"delete"!=n?-1!=["list_item_set","list_item_delete","list_item_insert","list_item_move"].indexOf(n)?"undefined"==typeof i?"modify_non_existent_field":"list"!=i.getType()?"modify_not_a_list_field":i.dryRun(e):"unknown_type":"undefined"==typeof i?"delete_non_existent_field":null}}),e(i)}),t.modules.define("cloud.dataSyncApi.Transaction",["cloud.dataSyncApi.Record","cloud.dataSyncApi.Operation","cloud.dataSyncApi.FieldOperation","component.util"],function(e,t,n,r,i){function o(e,n){var r={type:e};return n instanceof t?(r.collection_id=n.getCollectionId(),r.record_id=n.getRecordId()):(r.collection_id=n.collection_id,r.record_id=n.record_id),r}var a=function(e,t){this._database=e,this._patchCallback=t,this._deltaId="ya_cloud_data_js_api_1_"+Math.random().toString(),this._baseRevision=e.getRevision(),this._operations=[]};i.defineClass(a,{addOperations:function(e){return[].push.apply(this._operations,[].concat(e).map(function(e){return e instanceof n?e:new n(e)})),this},push:function(e){return this._patchCallback({delta_id:this._deltaId,base_revision:this._baseRevision,operations:this._operations},e)},getDatabase:function(){return this._database},getBaseRevision:function(){return this._baseRevision},getOperations:function(){return this._operations.slice()},insertRecords:function(e){return this.addOperations([].concat(e).map(function(e){var i=o("insert",e);return e instanceof t?i.field_operations=e.getFieldIds().map(function(t){return new r({type:"set",field_id:t,value:e.getFieldValue(t)})}):i.field_operations=e.fields?Object.keys(e.fields).map(function(t){return new r({type:"set",field_id:t,value:e.fields[t]})}):[],new n(i)}))},deleteRecords:function(e){return this.addOperations([].concat(e).map(function(e){return new n(o("delete",e))}))},setRecordFields:function(e,t){var i=o("set",e);return Array.isArray(t)?i.field_operations=t:i.field_operations=Object.keys(t||{}).map(function(e){return new r({type:"set",field_id:e,value:t[e]})}),this.addOperations(new n(i))},updateRecordFields:function(e,t){var i=o("update",e);return Array.isArray(t)?i.field_operations=t:i.field_operations=Object.keys(t).map(function(e){return new r("undefined"==typeof t[e]?{type:"delete",field_id:e}:{type:"set",field_id:e,value:t[e]})}),this.addOperations(new n(i))},insertRecordFieldListItem:function(e,t){var i=o("update",e);return i.field_operations=[new r({type:"list_item_insert",field_id:t.field_id,index:t.index,value:t.value})],this.addOperations(new n(i))},setRecordFieldListItem:function(e,t){var i=o("update",e);return i.field_operations=[new r({type:"list_item_set",field_id:t.field_id,index:t.index,value:t.value})],this.addOperations(new n(i))},moveRecordFieldListItem:function(e,t){var i=o("update",e);return i.field_operations=[new r({type:"list_item_move",field_id:t.field_id,index:t.index,new_index:t.new_index})],this.addOperations(new n(i))},deleteRecordFieldListItem:function(e,t){var i=o("update",e);return i.field_operations=[new r({type:"list_item_delete",field_id:t.field_id,index:t.index})],this.addOperations(new n(i))}}),e(a)}),t.modules.define("cloud.dataSyncApi.Value",["component.util","cloud.Error"],function(t,n,r){function i(t){switch(typeof t){case"number":return t==Number.POSITIVE_INFINITY?"inf":t==Number.NEGATIVE_INFINITY?"ninf":e.isNaN(t)?"nan":"double";case"string":return"string";case"boolean":return"boolean";case"object":return null==t?"null":"undefined"!=typeof e.ArrayBuffer&&(t instanceof ArrayBuffer||t.buffer&&t.buffer instanceof ArrayBuffer)?"binary":t instanceof Date?"datetime":t instanceof Boolean?"boolean":t instanceof Number?"double":Array.isArray(t)?"list":"string";default:throw new r({message:"Type unknown"})}}function o(t,n){switch(t){case"string":return n.toString();case"integer":return Math.floor(Number(n));case"double":return Number(n);case"boolean":return n instanceof Boolean?n.valueOf():Boolean(n);case"datetime":return n instanceof Date?n.toISOString():n;case"binary":return"undefined"!=typeof e.ArrayBuffer?n instanceof ArrayBuffer?e.btoa(String.fromCharCode.apply(null,new Uint8Array(n))):n.buffer&&n.buffer instanceof ArrayBuffer?e.btoa(String.fromCharCode.apply(null,new Uint8Array(n.buffer))):n.toString():n.toString();case"null":return null;case"inf":return Number.POSITIVE_INFINITY;case"ninf":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;case"list":return n.map(function(e){return e instanceof c?e:new c(e)});default:throw new r({message:"Type unknown"})}}function a(e,t){return"list"==e?t.map(function(e){return e.copy()}):t}function s(e){e=e.replace(/[^A-Za-z0-9\+\/]/g,"");for(var t,n,r=e.length,i=3*r+1>>2,o=new Uint8Array(i),a=0,s=0,c=0;r>c;c++)if(n=3&c,a|=u(e.charCodeAt(c))<<18-6*n,3==n||r-c==1){for(t=0;3>t&&i>s;t++,s++)o[s]=a>>>(16>>>t&24)&255;a=0}return o.buffer}function u(e){return e>64&&91>e?e-65:e>96&&123>e?e-71:e>47&&58>e?e+4:43==e?62:47==e?63:0}var c=function(e){e&&e.type?(this._type=e.type,this._value=o(this._type,e.value)):(this._type=i(e),this._value=o(this._type,e))};c.json={serialize:function(e){var t={};return t.type=e._type,-1!=["null","nan","inf","ninf"].indexOf(t.type)?t[t.type]=!0:"list"==t.type?t.list=e._value.map(c.json.serialize):t[t.type]=e._value,t},deserialize:function(e){var t={type:e.type};return"list"==e.type?t.value=e.list?e.list.map(c.json.deserialize):[]:-1==["null","nan","inf","ninf"].indexOf(e.type)&&(t.value=e[e.type]),new c(t)}},n.defineClass(c,{getType:function(){return this._type},valueOf:function(e){return e&&"binary"==this._type?s(this._value):"datetime"==this._type?new Date(this._value):this._value},toString:function(){return this._value.toString()},copy:function(){return new c({type:this._type,value:a(this._type,this._value)})},applyListOperation:function(e){var t=this.dryRun(e);if(t)throw new r({code:409,type:t});var n=e.getType(),i=e.getIndex(),o=this._value;switch(n){case"list_item_set":o[i]=e.getValue();break;case"list_item_move":var a=o[i],s=e.getNewIndex();i!=s&&(o.splice(i,1),o.splice(s,0,a));break;case"list_item_insert":o.splice(i,0,e.getValue());break;case"list_item_delete":o.splice(i,1)}return this},dryRun:function(e){var t=e.getType(),n=e.getIndex(),r=this._value;switch(t){case"list_item_set":if(n>=r.length||0>n)return"incorrect_list_index";break;case"list_item_move":var i=e.getNewIndex();if(n>=r.length||0>n||i>=r.length||0>i)return"incorrect_list_index";break;case"list_item_insert":if(n>r.length||0>n)return"incorrect_list_index";break;case"list_item_delete":if(n>=r.length||0>n)return"incorrect_list_index";break;default:return"unknown_type"}return null}}),t(c)}),t.modules.define("cloud.dataSyncApi.config",function(e){e({apiHost:"https://cloud-api.yandex.net/",contexts:{app:!0,user:!0},oauthLoginPage:"https://oauth.yandex.ru/authorize?response_type=token&client_id={{ key }}",oauthWindowParameters:"width=600,height=500",storagePrefix:"yandex_cloud_data_sync_v1_",deltaLimit:100})}),t.modules.define("cloud.dataSyncApi.http",["cloud.dataSyncApi.config","cloud.client","component.xhr","component.util","vow","cloud.Error"],function(e,t,n,r,i,o,a){var s=function(e){return e?u(e.context)?void 0:c("Invalid `options.context` Value"):c("`options` Parameter Required")},u=function(e){return e&&t.contexts[e]},c=function(e,t){return t||(t=e,e=400),o.reject(new a({code:e,message:t}))},d=function(e,t){var r=i.extend({},t);return r.headers?r.headers=i.extend({},r.headers):r.headers={},e.token?(r.headers.Authorization="OAuth "+e.token,o.resolve(r)):n.isInitiaized()?(n.withCredentials()?r.withCredentials=!0:r.headers.Authorization="OAuth "+n.getToken(),o.resolve(r)):e&&(e.authorize_if_needed||"undefined"==typeof e.authorize_if_needed)?n.initialize(e).then(function(){return n.withCredentials()?r.withCredentials=!0:r.headers.Authorization="OAuth "+n.getToken(),r}):o.reject(new a({code:401}))};e({getDatabases:function(e){var n,i=t.apiHost+"v1/data/"+e.context+"/databases";return e&&e.database_id?i+="/"+e.database_id:n={limit:Number(e&&e.limit),offset:Number(e&&e.offset)},s(e)||d(e,{queryParams:n,parse:!0}).then(function(e){return r(i,e)})},putDatabase:function(e){var n=s(e);return n||"string"==typeof e.database_id||(n=c("`options.database_id` Parameter Required")),n||d(e,{method:"PUT",parse:!0}).then(function(n){return r(t.apiHost+"v1/data/"+e.context+"/databases/"+e.database_id,n);
})},deleteDatabase:function(e){var n=s(e);return n||"string"==typeof e.database_id||(n=c("`options.database_id` Parameter Required")),n||d(e,{method:"DELETE",parse:!1}).then(function(n){return r(t.apiHost+"v1/data/"+e.context+"/databases/"+e.database_id,n)})},getSnapshot:function(e){return s(e)||d(e,{parse:!0}).then(function(n){return r(t.apiHost+"v1/data/"+e.context+"/databases/"+e.database_id+"/snapshot",n)})},getDeltas:function(e){var n=s(e);return n||"string"==typeof e.database_id||(n=c("`options.database_id` Parameter Required")),n||"number"==typeof e.base_revision||(n=c("`options.base_revision` Parameter Required")),n||d(e,{method:"GET",queryParams:{base_revision:e.base_revision,limit:"undefined"==typeof e.limit?100:e.limit},parse:!0}).then(function(n){return r(t.apiHost+"v1/data/"+e.context+"/databases/"+e.database_id+"/deltas",n)})},postDeltas:function(e){var n=s(e);return n||"string"==typeof e.database_id||(n=c("`options.database_id` Parameter Required")),n||"number"==typeof e.base_revision||(n=c("`options.base_revision` Parameter Required")),n||"object"==typeof e.data||(n=c("`options.data` Parameter Required")),n||d(e,{method:"POST",headers:{"If-Match":e.base_revision},parse:!0,data:e.data}).then(function(n){return r(t.apiHost+"v1/data/"+e.context+"/databases/"+e.database_id+"/deltas",n)})}})}),t.modules.define("cloud.dataSyncApi.politics",[],function(e){e({theirs:function(e,t){var n=t.reduce(function(e,t){return e[t.index]=!0,e},{}),r=[];return e.forEach(function(e,t){n[t]||r.push(e)}),r}})}),t.modules.define("global",function(t){t(e)}),"object"==typeof module)module.exports=t;else{var r=e.ya||(e.ya={});r.modules=t.modules,r.vow=t.vow,r.cloud=t.cloud}}(this);